<!--http://www.bennadel.com/blog/2996-angularjs-2-beta-1-hello-world-with-es5-and-requirejs.htm-->

<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>
        AngularJS 2 Beta 1: Hello World With ES5 And RequireJS
    </title>
</head>
<body>

<my-app>
    Loading...
</my-app>

<!-- 1. Load libraries -->
<!-- IE required polyfill -->
<script src="node_modules/es6-shim/es6-shim.min.js"></script>
<script src="node_modules/rxjs/bundles/Rx.umd.js"></script>
<script src="node_modules/angular2/bundles/angular2-polyfills.js"></script>
<script src="../angular2-all.umd.dev.js"></script>
<!--
    Putting Almond.js after the external libraries since I am not managing their
    loading through Almond. If I move this library up, AngularJS attempts to use
    define() (I think) which I am not configured for in this demo.
    --
    NOTE: AlmondJS is just a simplified version of RequireJS.
-->
<script type="text/javascript" src="../almond.js"></script>
<script type="text/javascript">

    document.addEventListener("DOMContentLoaded", function () {
        ng.platform.browser.bootstrap(AppComponent);
    });

                var AppComponent = ng.core
                        .Component({
                            selector: "my-app",
                            directives: [Friend],
                            template: '<h1>My First AngularJS 2 App !</h1 >' +
                            '< div * ngIf = "! isLoading" >' +
                            '<h2> You  Have {{ friends.length }}Friends!< / h2 >' +
                            '<ul>' +
                            '<li * ngFor ="#friend of friends">' +
                            '               < friend [id] = "friend.id" [name] = "friend.name" > < / friend > ' +
                            '</li>' +
                            '</ul>' +
                            '</div>'
                        })
                        .Class({
                            constructor: AppController,
                            ngOnInit: function noop() {
                            } /* Will be discussed in another post. */
                        });
                AppComponent.parameters = [new ng.core.Inject(FriendService)];
                /*    return ( AppComponent );*/
                // I control the app component.
                function AppController(friendService) {
                    var vm = this;
                    // I determine if the data is being loaded.
                    vm.isLoading = true;
                    // I hold the collection of friends.
                    vm.friends = null;
                    // Expose public methods.
                    vm.ngOnInit = ngOnInit;
                    // ---
                    // PUBLIC METHODS.
                    // ---
                    // I get called once, after the component has been instantiated and
                    // after the inputs have been bound.
                    function ngOnInit() {
                        friendService.getFriends().then(
                                function handleResolve(friends) {
                                    vm.isLoading = false;
                                    vm.friends = friends;
                                }
                        );
                    }

                var FriendComponent = ng.core
                                .Component({
                                    selector: "friend",
                                    inputs: ["id", "name"],
                                    template:'<span data - id = "{{ id }}" > {{name}} is awesome !< / span >'
                                })
                                .Class({
                                    constructor: FriendController
                                });
                function FriendController() {

                }
                // Configure the friend service definition.
                var FriendServiceClass = ng.core.Class({
                    constructor: FriendService
                });
                // I provide access to the friend repository.
                function FriendService() {
                    // Build the internal cache of friends.
                    var friends = buildFriends("Sarah", "Joanna", "Tricia");
                    // Return the public API.
                    return ({
                        getFriends: getFriends
                    });
                    // ---
                    // PUBLIC API.
                    // ---
                    // I get all the friends. Returns a promise.
                    function getFriends() {
                        return ( Promise.resolve(friends) );
                    }

                    // ---
                    // PRIVATE API.
                    // ---
                    // I turn the given list of names into a collection of friend objects.
                    function buildFriends(/* ...names */) {
                        var id = 0;
                        var collection = Array.prototype.slice.call(arguments).map(
                                function iterator(name) {
                                    return ({
                                        id: ++id,
                                        name: name
                                    });
                                }
                        );
                        return ( collection );
                    }
                }
                }
</script>

</body>
</html>